# ğŸ“š ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ·ï¸ ç›®çš„

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€AI English Learning App MVPã®è¨­è¨ˆæ€æƒ³ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜éŒ²ã—ãŸã‚‚ã®ã§ã™ã€‚
å°†æ¥ã®é–‹ç™ºè€…ã‚„è‡ªåˆ†è‡ªèº«ãŒè¨­è¨ˆåˆ¤æ–­ã®èƒŒæ™¯ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ã€æ¡ç”¨ã—ã¦ã„ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ç†ç”±ã‚’æ˜æ–‡åŒ–ã—ã¾ã™ã€‚

**ä½œæˆæ—¥**: 2025-11-22  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0.0 (MVP)

---

## ğŸ—ï¸ æ¡ç”¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### **ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ + ã‚µãƒ¼ãƒ“ã‚¹å±¤ãƒ‘ã‚¿ãƒ¼ãƒ³**

ã“ã®MVPã¯ä»¥ä¸‹ã®4å±¤æ§‹é€ ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤)    â”‚  
â”‚  ğŸ“ å½¹å‰²: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†        â”‚
â”‚  ğŸ“ å ´æ‰€: app/routers/**/*.py                â”‚
â”‚  ä¾‹: @router.post("/{session_id}/turn")     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä¾å­˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Business Logic Layer (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤)     â”‚
â”‚  ğŸ“ å½¹å‰²: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯        â”‚
â”‚  ğŸ“ å ´æ‰€: app/services/**/*.py               â”‚
â”‚  ä¾‹: SessionService.process_turn()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä¾å­˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Access Layer (ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤)          â”‚
â”‚  ğŸ“ å½¹å‰²: DBæ“ä½œã€æ°¸ç¶šåŒ–                       â”‚
â”‚  ğŸ“ å ´æ‰€: models/database/models.py          â”‚
â”‚  ä¾‹: db.query(Session).filter(...)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä¾å­˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Infrastructure Layer (ã‚¤ãƒ³ãƒ•ãƒ©å±¤)            â”‚
â”‚  ğŸ“ å½¹å‰²: DBã€å¤–éƒ¨APIã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ           â”‚
â”‚  ğŸ“ å ´æ‰€: app/services/ai/*, db/session.py   â”‚
â”‚  ä¾‹: OpenAI API, Google TTS, PostgreSQL     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦ãªç‰¹å¾´ï¼š**
- ä¾å­˜é–¢ä¿‚ã¯**ä¸€æ–¹å‘ï¼ˆä¸Šã‹ã‚‰ä¸‹ï¼‰**ã®ã¿
- å„å±¤ã¯è‡ªåˆ†ã®ä¸‹ã®å±¤ã«ã®ã¿ä¾å­˜å¯èƒ½
- ä¸‹ã®å±¤ã¯ä¸Šã®å±¤ã‚’çŸ¥ã‚‰ãªã„

---

## ğŸ“‹ å„å±¤ã®è²¬ä»»ã¨å®Ÿè£…

### 1ï¸âƒ£ Presentation Layer (ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤)

**å ´æ‰€**: `apps/api/app/routers/**/*.py`

**è²¬ä»»ï¼š**
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä»˜
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- èªè¨¼ãƒ»èªå¯ã®ç¢ºèª
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ±ºå®š
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

**å®Ÿè£…ä¾‹ï¼š**
```python
# apps/api/app/routers/sessions/sessions.py
@router.post("/{session_id}/turn", response_model=TurnResponse)
async def process_turn(
    session_id: int,
    payload: Dict[str, Any],
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    try:
        session_service = SessionService(db)
        user_input = payload.get("user_input")
        
        if not user_input:
            raise HTTPException(status_code=400, detail="user_input is required")
        
        result = await session_service.process_turn(session_id, user_input, current_user.id)
        return result
        
    except ValueError as e:
        raise HTTPException(status_code=400, detail=str(e))
    except TimeoutError as e:
        raise HTTPException(status_code=504, detail="AIå¿œç­”ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ")
```

**ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨ï¼š**
- âŒ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- âŒ ç›´æ¥DBæ“ä½œ
- âŒ å¤–éƒ¨APIå‘¼ã³å‡ºã—

---

### 2ï¸âƒ£ Business Logic Layer (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤)

**å ´æ‰€**: `apps/api/app/services/**/*.py`

**è²¬ä»»ï¼š**
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®å®Ÿè£…
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
- è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œã®èª¿æ•´
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰æ•°ãƒã‚§ãƒƒã‚¯ã€å»¶é•·å¯å¦åˆ¤å®šãªã©ï¼‰

**ä¸»è¦ã‚µãƒ¼ãƒ“ã‚¹ï¼š**

#### SessionService
```python
# apps/api/app/services/conversation/session_service.py
class SessionService:
    def __init__(self, db: Session):
        self.db = db
    
    async def process_turn(self, session_id: int, user_input: str, user_id: int):
        """ã‚¿ãƒ¼ãƒ³å‡¦ç†ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯"""
        # 1. ãƒ‡ãƒ¼ã‚¿å–å¾—
        session = self.db.query(SessionModel).filter(...).first()
        
        # 2. ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
        if session.ended_at is not None:
            raise ValueError("Session has already ended")
        
        # 3. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—
        ai_response = await generate_conversation_response(...)
        
        # 4. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
        new_round = SessionRound(...)
        self.db.add(new_round)
        session.completed_rounds += 1
        self.db.commit()
        
        return TurnResponse(...)
```

**ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®3ã¤ã®å½¹å‰²ï¼š**

1. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã®å®šç¾©**
   - ä¸€é€£ã®æ“ä½œã‚’1ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ç®¡ç†

2. **è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œã®èª¿æ•´**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† + å¾©ç¿’ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆãªã©

3. **ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®é›†ç´„**
   - å»¶é•·å¯èƒ½æ€§åˆ¤å®šã€å®Œäº†åˆ¤å®šãªã©

**ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨ï¼š**
- âŒ HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ±ºå®š
- âŒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç›´æ¥æ“ä½œ

---

### 3ï¸âƒ£ Data Access Layer (ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤)

**å ´æ‰€**: `apps/api/models/database/models.py`

**è²¬ä»»ï¼š**
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®šç¾©
- ãƒ†ãƒ¼ãƒ–ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®å®šç¾©

**å®Ÿè£…ä¾‹ï¼š**
```python
# models/database/models.py
class Session(Base):
    __tablename__ = "sessions"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    completed_rounds = Column(Integer, default=0)
    round_target = Column(Integer, nullable=False)
    
    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    user = relationship("User", back_populates="sessions")
    session_rounds = relationship("SessionRound", back_populates="session")
```

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆï¼š**
```
users (1) â”€â”€â”€ (N) sessions (N) â”€â”€â”€ (1) scenarios
                    â”‚
                    â””â”€â”€ (N) session_rounds
users (1) â”€â”€â”€ (N) review_items
```

**æ³¨æ„ï¼š**
- ç¾åœ¨ã¯ã€Œè²§è¡€ç—‡ãƒ¢ãƒ‡ãƒ«ã€ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ã¿ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãªã—ï¼‰
- ã“ã‚Œã¯MVPæ®µéšã§ã¯é©åˆ‡ãªé¸æŠ

---

### 4ï¸âƒ£ Infrastructure Layer (ã‚¤ãƒ³ãƒ•ãƒ©å±¤)

**å ´æ‰€**: `apps/api/app/services/ai/*`, `apps/api/app/db/session.py`

**è²¬ä»»ï¼š**
- å¤–éƒ¨APIã¨ã®é€šä¿¡
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç®¡ç†
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›

**å®Ÿè£…ä¾‹ï¼š**
```python
# app/services/ai/openai_provider.py
class OpenAIConversationProvider:
    async def generate_response(self, user_input: str, ...):
        # OpenAI APIå‘¼ã³å‡ºã—
        response = await asyncio.wait_for(
            self._call_openai_api(messages),
            timeout=30.0
        )
        return ConversationResponse(...)
```

---

## ğŸ¯ é‡è¦ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. **Strategy + Factory ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆAIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æŠ½è±¡åŒ–ï¼‰**

è¤‡æ•°ã®AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¯¾å¿œã§ãã‚‹ã‚ˆã†ã€Strategy + Factoryãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã€‚

```python
# types.py - Protocol (Interface)
class ConversationProvider(Protocol):
    async def generate_response(...) -> ConversationResponse:
        ...

# factory.py - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ç™»éŒ²
def initialize_providers() -> None:
    AIProviderRegistry.register("mock", MockConversationProvider)
    AIProviderRegistry.register("openai", OpenAIConversationProvider)
    AIProviderRegistry.set_default(settings.AI_PROVIDER_DEFAULT)

# ä½¿ç”¨å´
async def generate_conversation_response(..., provider_name: str | None = None):
    provider_cls = AIProviderRegistry.get_provider(provider_name)
    provider = provider_cls()
    return await provider.generate_response(...)
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- âœ… è¤‡æ•°ã®AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆOpenAIã€Claudeã€Geminiãªã©ï¼‰ã«å¯¾å¿œå¯èƒ½
- âœ… é–‹ç™ºæ™‚ã¯Mockãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é–‹ç™º
- âœ… æœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ã§åˆ‡ã‚Šæ›¿ãˆ
- âœ… ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¿½åŠ æ™‚ã‚‚æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ãªã—ï¼ˆOpen/Closed Principleï¼‰

---

### 2. **ä¾å­˜æ€§æ³¨å…¥ï¼ˆDependency Injectionï¼‰**

FastAPIã®`Depends`ã‚’æ´»ç”¨ã—ãŸä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚

```python
# deps.py
async def get_current_user(
    credentials: Optional[HTTPAuthorizationCredentials] = Depends(security),
    db: Session = Depends(get_db)
) -> User:
    # èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯
    ...

# Router
@router.post("/sessions/start")
async def start_session(
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    # current_user ã¨ db ãŒè‡ªå‹•æ³¨å…¥ã•ã‚Œã‚‹
    ...
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- âœ… ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ï¼ˆãƒ¢ãƒƒã‚¯å¯èƒ½ï¼‰
- âœ… ç–çµåˆ
- âœ… ç’°å¢ƒåˆ¥ã®åˆ‡ã‚Šæ›¿ãˆãŒç°¡å˜ï¼ˆé–‹ç™ºç”¨devãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªå‹•ç”Ÿæˆãªã©ï¼‰

---

### 3. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã®åˆ†é›¢**

å„ã‚·ãƒŠãƒªã‚ªã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã€‚

```
prompts/
  â”œâ”€â”€ airport_checkin.py
  â”œâ”€â”€ business_meeting.py
  â”œâ”€â”€ restaurant_ordering.py
  â””â”€â”€ goal_progress_evaluation.py
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- âœ… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å¤‰æ›´ãŒã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã—ãªã„
- âœ… ã‚·ãƒŠãƒªã‚ªè¿½åŠ ãŒå®¹æ˜“
- âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒæ˜ç¢º
- âœ… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãŒç‹¬ç«‹ã—ã¦å¯èƒ½

---

### 4. **ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®å˜ä¸€è²¬ä»»åŸå‰‡ï¼ˆSRPï¼‰**

å„ã‚µãƒ¼ãƒ“ã‚¹ãŒæ˜ç¢ºãªè²¬ä»»ã‚’æŒã¤ï¼š

- `SessionService`: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ãƒ»ã‚¿ãƒ¼ãƒ³å‡¦ç†ãƒ»çµ‚äº†ãƒ»å»¶é•·
- `ReviewService`: å¾©ç¿’ã‚¢ã‚¤ãƒ†ãƒ ã®ç®¡ç†
- `GoalProgressService`: å­¦ç¿’ã‚´ãƒ¼ãƒ«é”æˆç‡åˆ¤å®š

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ

### React + TypeScript ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
src/
  â”œâ”€â”€ app/              # Next.js App Router (Pages)
  â”œâ”€â”€ components/       # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  â”‚   â”œâ”€â”€ ui/          # Atomsï¼ˆåŸºæœ¬éƒ¨å“ï¼‰
  â”‚   â”œâ”€â”€ audio/       # Molecules
  â”‚   â”œâ”€â”€ conversation/# Molecules
  â”‚   â”œâ”€â”€ scenario/    # Organisms
  â”‚   â””â”€â”€ layout/      # Templates
  â”œâ”€â”€ hooks/           # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
  â”œâ”€â”€ lib/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
  â”œâ”€â”€ contexts/        # React Context
  â””â”€â”€ types/           # TypeScriptå‹å®šç¾©
```

### ä¸»è¦ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. **Hooksä¸­å¿ƒã®ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢**

```typescript
// hooks/use-session-conversation.ts
export function useSessionConversation({
  sessionId,
  onSessionEnd,
  onRoundCompleted
}) {
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†
  // ã‚¿ãƒ¼ãƒ³é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
  // è‡ªå‹•éŸ³å£°å†ç”Ÿ
  // ã‚´ãƒ¼ãƒ«é€²æ—ç®¡ç†
}
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- UIã¨ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢
- å†åˆ©ç”¨æ€§ã®å‘ä¸Š
- ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§

---

#### 2. **React Query ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç®¡ç†**

```typescript
const statusQuery = useQuery({
  queryKey: ['session-status', sessionId],
  queryFn: () => fetchSessionStatus(sessionId),
  staleTime: 30_000,
})

const submitMutation = useMutation({
  mutationFn: (message: string) => submitTurn(sessionId, message),
  onSuccess: ...
})
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†è‡ªå‹•åŒ–
- âœ… æ¥½è¦³çš„æ›´æ–°ï¼ˆOptimistic Updatesï¼‰
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸€å…ƒåŒ–
- âœ… ãƒªãƒˆãƒ©ã‚¤ãƒ»ãƒãƒ¼ãƒªãƒ³ã‚°ã®æ¨™æº–åŒ–

---

#### 3. **å‹å®‰å…¨æ€§ã®å¾¹åº•**

```typescript
// types/conversation.ts
export interface ConversationTurn {
  id: string
  roundIndex: number
  userMessage: string
  aiReply: AIReply
  createdAt: string
}

export interface SessionGoalProgress {
  total: number
  achieved: number
  status: boolean[]
}
```

TypeScriptã§å‹å®‰å…¨æ€§ã‚’å¾¹åº•ã—ã€ãƒã‚°ã‚’å‰Šæ¸›ã€‚

---

## ğŸ†š ä»–ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®æ¯”è¼ƒ

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®é•ã„

| é …ç›® | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆæ¡ç”¨ï¼‰ | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ |
|------|---------------------------|-------------------|
| **ä¾å­˜æ–¹å‘** | ä¸€æ–¹å‘ï¼ˆä¸Šâ†’ä¸‹ï¼‰ | å†…å´å‘ãï¼ˆå¤–â†’å†…ï¼‰ |
| **ã‚³ã‚¢å±¤ã®ç‹¬ç«‹æ€§** | âŒ ã‚¤ãƒ³ãƒ•ãƒ©ã«ä¾å­˜ | âœ… å®Œå…¨ã«ç‹¬ç«‹ |
| **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§** | ğŸŸ¡ DBãƒ¢ãƒƒã‚¯å¿…è¦ | âœ… ç°¡å˜ï¼ˆInterfaceï¼‰ |
| **å®Ÿè£…ã‚³ã‚¹ãƒˆ** | ğŸŸ¢ ä½ã„ | ğŸ”´ é«˜ã„ï¼ˆæŠ½è±¡å±¤è¿½åŠ ï¼‰ |
| **å¤‰æ›´ã¸ã®å¼·ã•** | ğŸŸ¡ ä¸­ç¨‹åº¦ | âœ… éå¸¸ã«å¼·ã„ |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | ğŸŸ¢ ä½ã„ | ğŸ”´ é«˜ã„ |
| **MVPã«å‘ãã‹** | âœ… å‘ã | âŒ éå‰° |

#### ä¾å­˜é–¢ä¿‚ã®é•ã„

**ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆç¾åœ¨ï¼‰ï¼š**
```
Presentation (Router)
    â†“ ä¾å­˜ï¼ˆç›´æ¥å‚ç…§ï¼‰
Business Logic (Service)
    â†“ ä¾å­˜ï¼ˆç›´æ¥å‚ç…§ï¼‰
Data Access (Models)
    â†“ ä¾å­˜ï¼ˆç›´æ¥å‚ç…§ï¼‰
Infrastructure (DB, OpenAI)
```

**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼š**
```
         Frameworks & Drivers (æœ€å¤–å±¤)
                   â†‘
              Interface Adapters
                   â†‘
            Application Business Rules
                   â†‘
         Enterprise Business Rules (ä¸­å¿ƒ)
         
â€»ã™ã¹ã¦ã®ä¾å­˜ãŒå†…å´ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰ã‚’å‘ã
```

---

### DDDï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆï¼‰ã¨ã®é•ã„

ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã¯**å®Œå…¨ãªDDDã§ã¯ãªã„**ã€‚

#### DDDã§ã¯ãªã„éƒ¨åˆ†

1. **è²§è¡€ç—‡ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«**
   - ç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ«ã¯ãƒ‡ãƒ¼ã‚¿ä¿æŒã®ã¿
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯Serviceã«å®Ÿè£…

2. **ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¬ å¦‚**
   - ServiceãŒSQLAlchemyã‚’ç›´æ¥æ“ä½œ

3. **é›†ç´„ï¼ˆAggregateï¼‰ã®æœªå®šç¾©**
   - Sessionã¨SessionRoundã®æ•´åˆæ€§ç®¡ç†ãŒæ˜ç¢ºã§ãªã„

4. **ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®æ¬ å¦‚**
   - é‡è¦ãªãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ™ãƒ³ãƒˆãŒæš—é»™çš„

#### ã‚ãšã‹ã«DDDã£ã½ã„éƒ¨åˆ†

1. âœ… **ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã®ä½¿ç”¨**
   - Session, SessionRound, Scenario ãªã©ãƒ“ã‚¸ãƒã‚¹ç”¨èªãŒãã®ã¾ã¾ã‚³ãƒ¼ãƒ‰ã«

2. âœ… **å¢ƒç•Œã¥ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ†é›¢**
   - ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€å¾©ç¿’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãªã©

3. âœ… **ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®å­˜åœ¨**
   - SessionServiceã¯ä¸€ç¨®ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹

---

## âœ… è¨­è¨ˆåˆ¤æ–­ã®ç†ç”±

### ãªãœãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’é¸ã‚“ã ã‹

1. **MVPæ®µéšã«æœ€é©**
   - é–‹ç™ºé€Ÿåº¦ãŒé€Ÿã„
   - ç†è§£ã—ã‚„ã™ã„
   - ååˆ†ãªä¿å®ˆæ€§

2. **å­¦ç¿’ã‚³ã‚¹ãƒˆãŒä½ã„**
   - ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒã™ãã«ç†è§£ã§ãã‚‹
   - FastAPIã®æ¨™æº–çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³

3. **æ®µéšçš„ãªé€²åŒ–ãŒå¯èƒ½**
   - å¿…è¦ã«ãªã‚Œã°å¾ã€…ã«æ”¹å–„å¯èƒ½

### ãªãœã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ãªã‹ã£ãŸã‹

1. **éå‰°ãªæŠ½è±¡åŒ–**
   - MVPã«ã¯ä¸è¦ãªè¤‡é›‘æ€§
   - é–‹ç™ºé€Ÿåº¦ã®ä½ä¸‹

2. **YAGNIåŸå‰‡**
   - "You Aren't Gonna Need It"
   - ä»Šå¿…è¦ãªã„æ©Ÿèƒ½ã¯å®Ÿè£…ã—ãªã„

3. **é©ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹æ¥µã‚**
   - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒè¤‡é›‘åŒ–ã—ãŸã‚‰ç§»è¡Œ

---

## ğŸš€ å°†æ¥ã®é€²åŒ–ãƒ‘ã‚¹

å¿…è¦ã«å¿œã˜ã¦æ®µéšçš„ã«é€²åŒ–ã•ã›ã‚‹ï¼š

```
ç¾åœ¨: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ + ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆMVPï¼‰
  â†“
ã‚¹ãƒ†ãƒƒãƒ—1: ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ 
  - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŠ½è±¡åŒ–
  - ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§å‘ä¸Š
  â†“
ã‚¹ãƒ†ãƒƒãƒ—2: ãƒªãƒƒãƒãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
  - ãƒ¢ãƒ‡ãƒ«ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç§»å‹•
  - ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆå°å…¥
  â†“
ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
  - ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡é©ç”¨
  - å®Œå…¨ãªç‹¬ç«‹æ€§ç¢ºä¿
```

### ç§»è¡Œã‚’æ¤œè¨ã™ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°

- âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒè¤‡é›‘åŒ–ã—ãŸã¨ã
- âœ… è¤‡æ•°ãƒãƒ¼ãƒ ã§é–‹ç™ºã™ã‚‹ã¨ã
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å¤§å¹…ã«ä¸Šã’ãŸã„ã¨ã
- âœ… å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ä¾å­˜ãŒå¢—ãˆãŸã¨ã
- âœ… ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã‚’æ¤œè¨ã™ã‚‹ã¨ã

---

## ğŸ“Š ç‰¹ã«å„ªã‚ŒãŸè¨­è¨ˆåˆ¤æ–­

### 1. **å†ªç­‰æ€§ã®æ‹…ä¿**

```python
def end_session(self, session_id: int, user_id: int):
    if session.ended_at:
        # æ—¢ã«çµ‚äº†æ¸ˆã¿ã®å ´åˆã‚‚åŒã˜ã‚µãƒãƒªãƒ¼ã‚’è¿”ã™
        return self._build_end_response(session, db_rounds)
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®å†é€ã«å¯¾å¿œ
- UIã®å®‰å®šæ€§å‘ä¸Š

---

### 2. **å˜èª¿å¢—åŠ åˆ¶å¾¡ï¼ˆã‚´ãƒ¼ãƒ«é”æˆç‡ï¼‰**

```python
# é”æˆç‡ãŒ0â†’1ã®ã¿è¨±å¯ã€1â†’0ã¯ç¦æ­¢ï¼ˆAIåˆ¤å®šã®æºã‚Œå¯¾ç­–ï¼‰
new_status[i] = prev_status[i] or current_status[i]
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- AIã®åˆ¤å®šæºã‚Œã«å¯¾å¿œ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä¸€è²«æ€§

---

### 3. **æ¥½è¦³çš„UIæ›´æ–°**

```typescript
onMutate: async (message) => {
  // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‰ã«UIã‚’å³åº§ã«æ›´æ–°
  setTurns((prev) => [...prev, pendingTurn])
}
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- å³åº§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- ä½“æ„Ÿé€Ÿåº¦ã®å‘ä¸Š

---

### 4. **é–‹ç™ºä½“é¨“ã®æœ€é©åŒ–**

- DEBUGãƒ¢ãƒ¼ãƒ‰ã§devãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªå‹•ç”Ÿæˆ
- Mockãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é–‹ç™ºå¯èƒ½
- ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ

---

### 5. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®éšå±¤åŒ–**

å„å±¤ã§é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼š

```python
# Serviceå±¤: ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼
raise ValueError("Session has already ended")

# Routerå±¤: HTTPã‚¨ãƒ©ãƒ¼ã«å¤‰æ›
except ValueError as e:
    raise HTTPException(status_code=400, detail=str(e))
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### æ›¸ç±
- ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ Martin Fowler
- ã€Clean Architectureã€ Robert C. Martin
- ã€å®Ÿè·µãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã€ Vaughn Vernon

### ã‚ªãƒ³ãƒ©ã‚¤ãƒ³
- [FastAPI Best Practices](https://fastapi.tiangolo.com/tutorial/)
- [React Architecture Patterns](https://react.dev/learn/thinking-in-react)
- [Service Layer Pattern](https://martinfowler.com/eaaCatalog/serviceLayer.html)

---

## ğŸ”„ æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2025-11-22 | åˆç‰ˆä½œæˆï¼ˆv1.0.0 MVPæ™‚ç‚¹ï¼‰ |

---

## ğŸ‘¥ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯é–‹ç™ºãƒãƒ¼ãƒ ã«ã‚ˆã£ã¦ç¶­æŒã•ã‚Œã¦ã„ã¾ã™ã€‚
è³ªå•ã‚„ææ¡ˆãŒã‚ã‚Œã°ã€Issueã¾ãŸã¯ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

